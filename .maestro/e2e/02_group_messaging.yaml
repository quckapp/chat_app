# E2E Scenario 02: Group Messaging
# Device A: Create group with User B -> send message
# Device B (WS): Receives message:new on group conversation channel
appId: com.quckapp.chat_app

env:
  PHONE: "9999900001"
  OTP_DIGIT_0: "1"
  OTP_DIGIT_1: "2"
  OTP_DIGIT_2: "3"
  OTP_DIGIT_3: "4"
  OTP_DIGIT_4: "5"
  OTP_DIGIT_5: "6"
  FIRST_NAME: "E2E"
  LAST_NAME: "UserA"
  USERNAME: "e2e_user_a"
  MESSAGE_TEXT: "Group hello from E2E!"

- launchApp:
    clearState: true

# Login as User A
- runFlow: ../subflows/login.yaml

# Navigate to create group
- assertVisible: "Chats"
- tapOn:
    id: ".*FloatingActionButton.*"
- waitForAnimationToEnd
- assertVisible: "New Chat"

# Select "New Group" option
- tapOn: "New Group"
- waitForAnimationToEnd

# Search and add User B to group
- tapOn: "Search users"
- inputText: "E2E UserB"
- waitForAnimationToEnd
- tapOn: "E2E UserB"
- waitForAnimationToEnd

# Create the group
- tapOn: "Create"
- waitForAnimationToEnd

# Send message in group
- tapOn: "Message"
- inputText: "${MESSAGE_TEXT}"
- tapOn:
    id: ".*send.*"
- waitForAnimationToEnd

# Verify message appears
- assertVisible: "Group hello from E2E!"
- takeScreenshot: "02_group_messaging"
